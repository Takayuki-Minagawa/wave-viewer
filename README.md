# 📊 Wave Viewer

加速度データの波形分析を行うWebアプリケーションです。

## 🎯 概要

1列の数値データ（加速度データ）を読み込み、時系列波形とフーリエスペクトルをリアルタイムで表示・分析するツールです。
**防災科学技術研究所のK-net/KiK-net形式**にも対応しています。

## ✨ 機能

### データ入力
- CSV / TXT / DAT ファイルの読み込み
- **K-net / KiK-net形式の自動検出・読み込み**
- ドラッグ＆ドロップ対応
- サンプリング周波数の設定（K-net形式は自動設定）
- ヘッダー行スキップ機能

### 波形表示
- **加速度波形**（ズーム・パン対応）
- **速度波形**（加速度の積分により自動計算）
- **変位波形**（速度の積分により自動計算）
- X軸: 時間 [sec]
- Y軸: 加速度 [m/s², gal, g] / 速度 [m/s] / 変位 [cm]
- ベースライン補正（線形トレンド除去）適用

### フーリエスペクトル解析
- FFT（高速フーリエ変換）による周波数分析
- 振幅スペクトル / パワースペクトル 切替
- 線形 / 対数スケール 切替
- ハニング窓関数適用
- Y軸レンジは0.5Hz以上の最大値で自動設定

### 統計情報
- データ点数 / 継続時間
- 最大値 / 最小値
- 平均値 / 標準偏差
- RMS（二乗平均平方根）
- ピーク周波数

### データエクスポート
- 加速度データのCSVエクスポート
- 速度データのCSVエクスポート
- 変位データのCSVエクスポート
- 全データ（時間・加速度・速度・変位）の一括エクスポート
- Excel対応（BOM付きUTF-8）

## 📁 ファイル構成

```
wave-viewer/
├── index.html          # メインHTML
├── favicon.svg         # ファビコン（ダークモード）
├── favicon-light.svg   # ファビコン（ライトモード）
├── css/
│   └── style.css       # スタイルシート
├── js/
│   ├── main.js         # メインロジック
│   ├── fileReader.js   # ファイル読み込み（K-net対応）
│   ├── waveform.js     # 波形描画（Chart.js）
│   ├── fft.js          # フーリエ変換
│   ├── analysis.js     # 統計分析
│   └── i18n.js         # 多言語対応（国際化）
├── sample/
│   ├── sample_data.csv # サンプルデータ（1列形式）
│   └── K-net.EW        # サンプルデータ（K-net形式）
└── README.md           # このファイル
```

## 🚀 使い方

### 1. サーバーの起動

```bash
cd wave-viewer
python3 -m http.server 8080
```

### 2. ブラウザでアクセス

```
http://localhost:8080
```

### 3. データの読み込み

#### 1列データの場合
1. **ファイル選択**ボタンをクリック、またはドラッグ＆ドロップ
2. サンプリング周波数を設定（デフォルト: 100Hz）
3. 必要に応じてヘッダー行スキップ数を設定
4. データ単位を選択（m/s², gal, g）

#### K-net/KiK-netデータの場合
1. **ファイル選択**ボタンをクリック、またはドラッグ＆ドロップ
2. 自動的にフォーマットが検出され、以下が自動設定されます：
   - サンプリング周波数（例: 100Hz）
   - データ単位（gal）
   - スケールファクター適用
3. そのまま解析が実行されます（設定変更不要）

### 4. 結果の確認

- **上段**: 時系列波形グラフ
- **下段**: フーリエスペクトルグラフ
- **統計情報**: 各種統計値とピーク周波数
- **コンソール**: K-netデータの場合、観測点情報などが表示されます

## 📄 対応データ形式

本ツールは **2種類のデータ形式** に対応しています。フォーマットは自動判定されます。

### 1️⃣ 1列数値データ形式

#### 入力ファイル形式
- CSV（カンマ区切り）
- TXT（タブ区切り、スペース区切り）
- DAT

#### データ例
```
# 1列の数値データ（1行1データ）
0.0000
0.3090
0.5878
0.8090
...
```

#### 対応する数値形式
- 整数: `123`
- 小数: `1.234`
- 科学的表記: `1.23e-4`
- カンマ区切り: `1,234.56`

---

### 2️⃣ K-net / KiK-net形式（防災科学技術研究所）

防災科学技術研究所の強震観測網データに対応しています。

#### 特徴
- **自動検出**: ファイルを読み込むだけで自動的にK-net形式を判定
- **自動設定**: サンプリング周波数、スケールファクター、単位を自動設定
- **メタデータ抽出**: 観測点コード、方向、継続時間などを自動取得

#### データ構造
```
Origin Time       2026/02/05 03:21:00
Lat.              29.1
Long.             130.4
...
Sampling Freq(Hz) 100Hz
Duration Time(s)  60
Dir.              E-W
Scale Factor      7845(gal)/8223790
...
    -734     -591     -441     -309  ...
    -324     -376     -454     -522  ...
```

#### 自動処理される項目
- ✅ サンプリング周波数の自動設定
- ✅ スケールファクターの自動適用
- ✅ データ単位をgalに自動設定
- ✅ ヘッダー17行の自動スキップ
- ✅ 観測点情報の抽出（コンソールに出力）

## ⚙️ 設定パラメータ

| パラメータ | 説明 | デフォルト | K-net形式 |
|-----------|------|-----------|----------|
| サンプリング周波数 | データの取得間隔 | 100 Hz | **自動設定** |
| ヘッダー行スキップ | 先頭からスキップする行数 | 0 行 | **自動処理** |
| データ単位 | 加速度の単位 | m/s² | **gal（自動）** |

> **Note**: K-net/KiK-net形式のファイルでは、設定パラメータは自動的に適用されます。

## 🖥️ グラフ操作

### ズーム
- マウスホイール: 拡大・縮小

### パン
- ドラッグ: グラフの移動

### リセット
- 「リセット」ボタン: 初期表示に戻る

## 🛠️ 技術スタック

- **HTML5 / CSS3 / JavaScript**（Vanilla JS）
- **Chart.js** - グラフ描画ライブラリ
- **chartjs-plugin-zoom** - ズーム・パン機能
- **FFT** - Cooley-Tukey アルゴリズム（自作実装）

## 📝 ライセンス

MIT License

## 🔧 更新履歴

### v1.3.1 (2026-02-06)

- ✅ **K-netデータ読み込みのバグ修正**
  - データ行の検出ロジックを修正し、正しくK-net形式を認識するよう改善
- ✅ **スペクトルY軸レンジの最適化**
  - フーリエスペクトル・パワースペクトルのY軸レンジを0.5Hz以上の最大値で自動設定
  - 低周波成分に引きずられずに有意な周波数帯域が見やすく表示

### v1.3.0 (2026-02-06)

- ✅ **多言語対応（国際化）**
  - 日本語/英語の切り替え機能
  - UI全体の多言語化（ボタン、ラベル、チャート、統計情報）
  - 選択した言語をローカルストレージに保存
- ✅ **Web内簡易マニュアル**
  - クイックスタートガイド
  - 対応データ形式の説明
  - 主な機能と操作方法
  - 注意事項
  - 多言語対応（日本語/英語）

### v1.2.0 (2026-02-06)

- ✅ **速度・変位波形計算機能**
  - 加速度データから速度波形を自動計算（積分処理）
  - 速度データから変位波形を自動計算（2重積分）
  - ベースライン補正（線形トレンド除去）機能
- ✅ **データエクスポート機能**
  - 加速度・速度・変位データの個別CSVエクスポート
  - 全データの一括CSVエクスポート
  - Excel対応（BOM付きUTF-8）

### v1.1.0 (2026-02-06)

- ✅ **K-net/KiK-net形式対応**
  - 防災科学技術研究所の強震観測網データの自動検出・読み込み
  - サンプリング周波数、スケールファクターの自動適用
  - メタデータ（観測点コード、方向等）の自動抽出
- ✅ **ファビコン追加**
  - ダークモード・ライトモード対応のSVGロゴ

### v1.0.0

- 初期リリース
- 1列数値データの読み込み・解析機能

## 🔧 今後の拡張予定

- [ ] フィルタリング機能（ローパス/ハイパス/バンドパス）
- [ ] 窓関数の選択（ハミング、ブラックマン等）
- [ ] データエクスポート機能（CSV/JSON）
- [ ] グラフ画像保存機能（PNG/SVG）
- [ ] 複数ファイルの比較表示
- [ ] 応答スペクトル解析
- [ ] 3成分データ（NS/EW/UD）の同時表示

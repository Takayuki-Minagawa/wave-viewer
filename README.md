# 📊 Wave Viewer

加速度データの波形分析を行うWebアプリケーションです。

## 🎯 概要

1列の数値データ（加速度データ）を読み込み、時系列波形とフーリエスペクトルをリアルタイムで表示・分析するツールです。
**防災科学技術研究所のK-net/KiK-net形式**にも対応しています。

## ✨ 機能

### データ入力
- CSV / TXT / DAT ファイルの読み込み
- **K-net / KiK-net形式の自動検出・読み込み**
- ドラッグ＆ドロップ対応
- サンプリング周波数の設定（K-net形式は自動設定）
- ヘッダー行スキップ機能

### 波形表示
- 時系列波形グラフ（ズーム・パン対応）
- X軸: 時間 [sec]
- Y軸: 加速度 [m/s², gal, g]

### フーリエスペクトル解析
- FFT（高速フーリエ変換）による周波数分析
- 振幅スペクトル / パワースペクトル 切替
- 線形 / 対数スケール 切替
- ハニング窓関数適用

### 統計情報
- データ点数 / 継続時間
- 最大値 / 最小値
- 平均値 / 標準偏差
- RMS（二乗平均平方根）
- ピーク周波数

## 📁 ファイル構成

```
wave-viewer/
├── index.html          # メインHTML
├── favicon.svg         # ファビコン（ダークモード）
├── favicon-light.svg   # ファビコン（ライトモード）
├── css/
│   └── style.css       # スタイルシート
├── js/
│   ├── main.js         # メインロジック
│   ├── fileReader.js   # ファイル読み込み（K-net対応）
│   ├── waveform.js     # 波形描画（Chart.js）
│   ├── fft.js          # フーリエ変換
│   └── analysis.js     # 統計分析
├── sample/
│   ├── sample_data.csv # サンプルデータ（1列形式）
│   └── K-net.EW        # サンプルデータ（K-net形式）
└── README.md           # このファイル
```

## 🚀 使い方

### 1. サーバーの起動

```bash
cd wave-viewer
python3 -m http.server 8080
```

### 2. ブラウザでアクセス

```
http://localhost:8080
```

### 3. データの読み込み

#### 1列データの場合
1. **ファイル選択**ボタンをクリック、またはドラッグ＆ドロップ
2. サンプリング周波数を設定（デフォルト: 100Hz）
3. 必要に応じてヘッダー行スキップ数を設定
4. データ単位を選択（m/s², gal, g）

#### K-net/KiK-netデータの場合
1. **ファイル選択**ボタンをクリック、またはドラッグ＆ドロップ
2. 自動的にフォーマットが検出され、以下が自動設定されます：
   - サンプリング周波数（例: 100Hz）
   - データ単位（gal）
   - スケールファクター適用
3. そのまま解析が実行されます（設定変更不要）

### 4. 結果の確認

- **上段**: 時系列波形グラフ
- **下段**: フーリエスペクトルグラフ
- **統計情報**: 各種統計値とピーク周波数
- **コンソール**: K-netデータの場合、観測点情報などが表示されます

## 📄 対応データ形式

本ツールは **2種類のデータ形式** に対応しています。フォーマットは自動判定されます。

### 1️⃣ 1列数値データ形式

#### 入力ファイル形式
- CSV（カンマ区切り）
- TXT（タブ区切り、スペース区切り）
- DAT

#### データ例
```
# 1列の数値データ（1行1データ）
0.0000
0.3090
0.5878
0.8090
...
```

#### 対応する数値形式
- 整数: `123`
- 小数: `1.234`
- 科学的表記: `1.23e-4`
- カンマ区切り: `1,234.56`

---

### 2️⃣ K-net / KiK-net形式（防災科学技術研究所）

防災科学技術研究所の強震観測網データに対応しています。

#### 特徴
- **自動検出**: ファイルを読み込むだけで自動的にK-net形式を判定
- **自動設定**: サンプリング周波数、スケールファクター、単位を自動設定
- **メタデータ抽出**: 観測点コード、方向、継続時間などを自動取得

#### データ構造
```
     1→Origin Time       2026/02/05 03:21:00
     2→Lat.              29.1
     3→Long.             130.4
     ...
    11→Sampling Freq(Hz) 100Hz
    12→Duration Time(s)  60
    13→Dir.              E-W
    14→Scale Factor      7845(gal)/8223790
    ...
    18→    -734     -591     -441     -309  ...
    19→    -324     -376     -454     -522  ...
```

#### 自動処理される項目
- ✅ サンプリング周波数の自動設定
- ✅ スケールファクターの自動適用
- ✅ データ単位をgalに自動設定
- ✅ ヘッダー17行の自動スキップ
- ✅ 観測点情報の抽出（コンソールに出力）

## ⚙️ 設定パラメータ

| パラメータ | 説明 | デフォルト | K-net形式 |
|-----------|------|-----------|----------|
| サンプリング周波数 | データの取得間隔 | 100 Hz | **自動設定** |
| ヘッダー行スキップ | 先頭からスキップする行数 | 0 行 | **自動処理** |
| データ単位 | 加速度の単位 | m/s² | **gal（自動）** |

> **Note**: K-net/KiK-net形式のファイルでは、設定パラメータは自動的に適用されます。

## 🖥️ グラフ操作

### ズーム
- マウスホイール: 拡大・縮小

### パン
- ドラッグ: グラフの移動

### リセット
- 「リセット」ボタン: 初期表示に戻る

## 🛠️ 技術スタック

- **HTML5 / CSS3 / JavaScript**（Vanilla JS）
- **Chart.js** - グラフ描画ライブラリ
- **chartjs-plugin-zoom** - ズーム・パン機能
- **FFT** - Cooley-Tukey アルゴリズム（自作実装）

## 📝 ライセンス

MIT License

## 🔧 更新履歴

### v1.1.0 (2026-02-06)

- ✅ **K-net/KiK-net形式対応**
  - 防災科学技術研究所の強震観測網データの自動検出・読み込み
  - サンプリング周波数、スケールファクターの自動適用
  - メタデータ（観測点コード、方向等）の自動抽出

### v1.0.0

- 初期リリース
- 1列数値データの読み込み・解析機能

## 🔧 今後の拡張予定

- [ ] フィルタリング機能（ローパス/ハイパス/バンドパス）
- [ ] 窓関数の選択（ハミング、ブラックマン等）
- [ ] データエクスポート機能（CSV/JSON）
- [ ] グラフ画像保存機能（PNG/SVG）
- [ ] 複数ファイルの比較表示
- [ ] 応答スペクトル解析
- [ ] 3成分データ（NS/EW/UD）の同時表示
